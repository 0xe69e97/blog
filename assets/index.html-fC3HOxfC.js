import{_ as n,c as a,e,o as p}from"./app-igEGucXV.js";const t={};function o(l,s){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言"><span>前言</span></a></h2><p>哎，最近摸鱼比较多，导致需求给延期了 0.5d，下次摸鱼之前，一定先把需求拆分好，并且看看你的队友（前后端）的设计以及实现。否则到时候全是坑，埋的是自己。。</p><p>下次还要起摸鱼的开头，比较适合我，哈哈哈哈哈哈。进入正题！！！</p><h2 id="业务背景" tabindex="-1"><a class="header-anchor" href="#业务背景"><span>业务背景</span></a></h2><p>最近做的这个需求，类似于图片、视频（素材）的后台管理模块，实现起来很简单，筛选列表以及数据展示列表。But...问题不在于页面的业务逻辑，而是后端接口设计问题。。下文称为素材代表图片和视频页面的统称</p><p><strong>FBI Warning!</strong></p><p>这个需求就是我通过自己的奇淫妙想想到的那个<a href="https://juejin.cn/post/7034037550809366535" target="_blank" rel="noopener noreferrer">毛玻璃实现图片预览图</a>的需求，你说巧了不是？一个需求，搞到两个知识点并且和大家分享出来了～～</p><p>那么下面，咳咳，我继续用了之前给大家画的图，需求原型类似下面这样！！</p><p><img src="https://cdn.jsdelivr.net/gh/0xe69e97/image-PicX@master/Blog/image.7gfo0w2kc2k0.png" alt="image"></p><p>比如目前有素材的上传、下载、筛选项、列表、导出、下载等。</p><p>对应到后端就有了 <strong>12</strong> 个接口</p><ul><li>图片上传</li><li>图片下载</li><li>图片的筛选项</li><li>图片的列表</li><li>图片的导出</li><li>图片的下载</li><li>视频上传</li><li>视频下载</li><li>视频的筛选项</li><li>视频的列表</li><li>视频的导出</li><li>视频的下载</li></ul><p>以上。。。可是前端页面的 UI 几乎完全一致，只需要区分<strong>视频</strong>和<strong>图片</strong>的文案以及在请求对应的接口时，需要对应模块的前缀，例如图片是 image ，视频是 video 等等</p><h2 id="实现之前" tabindex="-1"><a class="header-anchor" href="#实现之前"><span>实现之前</span></a></h2><p>由于这个需求是之前一个系统里类似的模块，后端直接拿来使用，前端的 UI 改变了，而且之前代码写的比较臃肿且技术栈比较落后（先甩个锅，我来公司之前就有的模块）。难以维护，基于这两点，我肯定是需要重写的。</p><p>但是当我看到后端给我的接口文档时，我当时是拒绝的。。我希望后端可以统一接口，对前端暴露的字段以及接口最简单化（不然的话，你数据库给我，我直接增删改查数据库不也行吗？），可是后端老大哥给我的拒绝拒绝了。已经实现了（之前系统代码拿过来用的），不能改了。</p><p><img src="https://cdn.jsdelivr.net/gh/0xe69e97/image-PicX@master/Blog/image.3q2fceh00560.png" alt="image"></p><h2 id="设计前端中间层" tabindex="-1"><a class="header-anchor" href="#设计前端中间层"><span>设计前端中间层</span></a></h2><p>那既然后端老大哥不给改，咱就当锻炼咱们自己的能力了，你说是不？那就 nèng 吧！</p><p>在前一段时间还看了曾探大佬的《JavaScript 设计模式与开发实践》，受益良多。推荐！！！</p><p>首先为了复用以及组件的灵活性，将和其他模块类似的公共组件抽离出去，这里就不多说了。一个 SearchBar 组件以及一个 CardList 组件，供各个页面级组件来调用就好，自己传入对应的选项即可。主要来设计一下如何实现一套 UI 两套接口的中间层组件</p><p>废话不多说，直接上代码以及对应思路</p><h3 id="思路" tabindex="-1"><a class="header-anchor" href="#思路"><span>思路</span></a></h3><ol><li>页面根据不同的类型来区分视频和图片就好，扩展性较好，例如之后加了音频那就在加一个类型而已。通过枚举来将类型枚举出来，例如需要改枚举，只需要更改一个地方，整个系统都会变更</li><li>需要用到中介者模式，来将控制两个不同模块的展现以及对应的封装</li><li>利用原型技术实现职责链模式，动态统一封装接口</li><li>动态拼接（重写）参数来实现后端的不同字段参数传递</li></ol><h3 id="实现" tabindex="-1"><a class="header-anchor" href="#实现"><span>实现</span></a></h3><ol><li>页面根据不同的类型来区分比较好实现，你是通过 <code>Props</code> 或者是 URL 的 <code>query</code> 都可以。目前我是通过组件的 <code>Props</code> 来传递的</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">ImageManagement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token operator">&lt;</span>MaterialManagement type<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">MATERIAL_TYPE</span><span class="token punctuation">.</span><span class="token constant">IMAGE</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>利用中介者模式，封装统一的行为</li></ol><blockquote><p>中介者模式：中介者模式的作用就是解除对象与对象之间的紧耦合关系。 《JavaScript 设计模式与实践》 -- 曾探</p></blockquote><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">MediatorPattern</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">this</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span><span class="token operator">:</span> any <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type</span>
<span class="line">  <span class="token comment">// 先区分 image 例如后期加入其他类型，可以改成枚举形式，进行添加</span></span>
<span class="line">  <span class="token comment">// 这里只有 image 和 video 所以先区分一个即可</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>isImage <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token constant">MATERIAL_TYPE</span><span class="token punctuation">.</span><span class="token constant">IMAGE</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>prefix <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isImage <span class="token operator">?</span> <span class="token string">&#39;image&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;video&#39;</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isImage <span class="token operator">?</span> <span class="token string">&#39;图片&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;视频&#39;</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>method <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isImage <span class="token operator">?</span> imageAPI <span class="token operator">:</span> videoAPI</span>
<span class="line">  </span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// 业务使用必须用大写开头作为字段才可以认为是需要重写的参数</span></span>
<span class="line">  <span class="token comment">// 在最后一步，动态拼接参数时需要使用到</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>dynamicParams <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">  	<span class="token comment">// ...</span></span>
<span class="line">    <span class="token string">&#39;Size&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们的 UI 组件在这里其实不需要关心他到底是图片还是视频还是音频还是谁谁谁，我们只需要处理特定的，对应的逻辑即可。比如日后又增加了好几种类型，我们完全可以不用动 UI 层面的任何逻辑，只需要维护中介者对象即可。让所有类型之间的耦合断开。</p><ol start="3"><li>利用原型技术实现职责链模式，动态统一封装接口</li></ol><p>例如我现在需要一个列表的接口，目前通过中介者模式已经将我需要的方法塞入 <code>this.method</code> 里面了，这个时候我们就根据这里的方法去调用对应的接口即可，但是我们并不知道当前是图片还是视频的接口，所以需要职责链模式来做处理</p><blockquote><p>职责链模式：使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间 5 的耦合关系，将这些对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理它为止。 《JavaScript 设计模式与实践》 -- 曾探</p></blockquote><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 获取图片 / 视频列表</span></span>
<span class="line"><span class="token class-name">MediatorPattern</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getList</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">params</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> newParams <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">rewriteParams</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span></span>
<span class="line">  <span class="token comment">// 职责链模式，处理请求，如果当前链条无法处理，那么就往下继续处理</span></span>
<span class="line">  <span class="token comment">// 这里没有考虑兜底策略，大家可以根据自己的需求实际需要来加</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>method<span class="token punctuation">.</span>getImageList<span class="token operator">?.</span><span class="token punctuation">(</span>newParams<span class="token punctuation">)</span> <span class="token operator">??</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>method<span class="token punctuation">.</span>getVideoList<span class="token operator">?.</span><span class="token punctuation">(</span>newParams<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>?.  和 ?? 都为 ES6+ 的语法，第一次见到的同学可以去查查看哦</p></blockquote><p>所以我们只需要调用</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token literal-property property">pageNum</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token literal-property property">pageSize</span><span class="token operator">:</span> <span class="token number">10</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> MediatorPattern<span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">// ... 其他逻辑</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>就可以获取到当前【类型】的列表了，所以类似于上传、下载、导入等等接口都可以这么写，所以 UI 组件层面在获取数据时，只需要关心你要获取的是什么接口即可。</p><ol start="4"><li>动态拼接（重写）参数来实现后端的不同字段参数传递</li></ol><p>因为后端的参数以及返回到前端的参数也无法统一，既然我们都将所有的类型、功能、接口都进行了封装，所以在参数层面也需要对应的封装。</p><p>例如后端在返回到前端的尺寸字段为 <code>imageSize</code> 以及 <code>videoSize</code> 所以前端也需要对应的拼接，这里就比较简单了。直接上拼接代码</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 参数动态封装，主要用来区分图片和视频的类似参数，例如</span></span>
<span class="line"><span class="token comment">// { imageSize: &#39;&#39; }, { videoSize: &#39;&#39; } 实际使用时只需要 =&gt; { Size: &#39;&#39; }，会自动添加 image or video 前缀</span></span>
<span class="line"><span class="token class-name">MediatorPattern</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">rewriteParams</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">params</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token literal-property property">newParams</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dynamicParams<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      newParams<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">this</span><span class="token punctuation">.</span>prefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> params<span class="token punctuation">[</span>key<span class="token punctuation">]</span></span>
<span class="line">      <span class="token keyword">continue</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    newParams<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> params<span class="token punctuation">[</span>key<span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> newParams</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们根据变量命名来做的区分，这就需要我们的命名要保持良好的编程风格</p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><p>好了，到此我们的所有功能以及封装都已经完成了。</p><p>通过本次的需求开发，也想让大家感受一下，不要埋头苦干你目前的工作，每一次枯燥无味的需求里也有值得你去细细揣摩的思想！如果我只是埋头苦干这个需求，那么就是写完一个页面之后，直接复制组件，然后换一下文案以及 API 接口就可以了。对吧？总结一下这句话：<strong>Don’t repeat yourself</strong>，不要重复你自己。</p><p>好了，如果以上有哪里写的不对，大佬多担待，告诉我，及时更正！！</p><p>最后还是推荐一下曾探大佬的 <a href="https://book.douban.com/subject/26382780/" target="_blank" rel="noopener noreferrer">《JavaScript 设计模式与开发实践》</a>，推荐大家看看哦，十分的不错。</p><blockquote><p>写文不易啊！！！上次写的摸鱼的文章，已经导致这个需求延期了 0.5d 了。这个文章也是我下班赶紧跑回家写的，需求上周就已经提测了。才有时间过来写这篇文章。如果这里有一个或多个知识点让你 get 到了。就点个赞吧！没 get 到的，如果认真看完了，就知道我写的也挺不容易的，也给点个赞呗～～</p></blockquote>`,50)])])}const c=n(t,[["render",o]]),r=JSON.parse('{"path":"/post/2021/12/13/design/","title":"一套 UI 两套接口，如何利用设计模式优雅设计","lang":"zh-CN","frontmatter":{"title":"一套 UI 两套接口，如何利用设计模式优雅设计","subtitle":"由于后端区分了图片和视频接口，导致...","author":"离殊","date":"2021-12-13T00:00:00.000Z","useHeaderImage":true,"headerImage":"https://cdn.jsdelivr.net/gh/0xe69e97/image-PicX@master/games/Blood-Borne_004.1i19rcird1c0.webp","headerMask":"rgb(14, 21, 5, .4)","permalinkPattern":"/post/:year/:month/:day/:slug/","tags":["设计模式"]},"git":{"updatedTime":1760173234000,"contributors":[{"name":"0xe69e97","username":"0xe69e97","email":"0xe69e97@gmail.com","commits":4,"url":"https://github.com/0xe69e97"}],"changelog":[{"hash":"8b50bf6141b1287f40e857d7ad53c66753a52b56","time":1760173234000,"email":"lishu@example.com","author":"0xe69e97","message":"feat: 完成文档升级"},{"hash":"4bfeafe7108a3396b1b0c74ab58d967396ca0f9f","time":1650297463000,"email":"0xe69e97@gmail.com","author":"0xe69e97","message":"feat: 修改花名"},{"hash":"de4a7a5d9bed30a09e003480d75caeabd43473f7","time":1648797498000,"email":"0xe69e97@gmail.com","author":"0xe69e97","message":"feat: 迁移图片到 CDN"},{"hash":"f0c39e30c97cfd90120f87e27235d25e52ed8b70","time":1648727890000,"email":"0xe69e97@gmail.com","author":"0xe69e97","message":"feat: 迁移之前文章，添加首页背景图（魂1 ，魂3，血缘）"}]},"filePathRelative":"posts/2021/2021-12-13-design.md"}');export{c as comp,r as data};
